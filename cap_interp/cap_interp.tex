%Este trabalho está licenciado sob a Licença Creative Commons Atribuição-CompartilhaIgual 3.0 Não Adaptada. Para ver uma cópia desta licença, visite http://creativecommons.org/licenses/by-sa/3.0/ ou envie uma carta para Creative Commons, PO Box 1866, Mountain View, CA 94042, USA.

%\documentclass[main.tex]{subfiles}
%\begin{document}

\chapter{Interpolação}\index{aproximação!de funções}

Neste capítulo, discutimos sobre problemas de \emph{interpolação}\index{interpolação}. Mais precisamente, dado um conjunto com $n$ pontos $\left\{(x_i, y_i)\in \mathbb{R}^2\right\}_{i=1}^n$ e uma família de funções $\mathcal{F} = \{f:\mathbb{R}\to\mathbb{R}; y = f(x)\}$, o problema de interpolação consiste em encontrar uma função $f\in\mathcal{F}$ tal que:
\begin{equation*}
  f(x_i) = y_i,\quad i=1, 2, \dotsc, n.
\end{equation*}
Chamamos uma tal $f(x)$ de \emph{função interpoladora} dos pontos dados. Ou ainda, dizemos que $f(x)$ interpola os pontos dados.

\begin{figure}
  \centering
  \includegraphics[scale=0.9]{./cap_interp/pics/ex_intro_interpolacao/ex_intro_interpolacao}
  \caption{Exemplo de interpolação de dois pontos por uma reta, veja o Exemplo~\ref{ex:intro_interpolacao}.}\label{fig:ex_intro_interp}
\end{figure}

\begin{ex}\label{ex:intro_interpolacao}
  Um dos problemas de interpolação mais simples é o de entrar a equação da reta que passa por dois pontos dados. Por exemplo, sejam dados o conjunto de pontos $\{(1, 1), (2, 2)\}$ e a família de funções $\mathcal{F} = \{f(x) = a + bx; a,b\in\mathbb{R}\}$. Para que uma $f(x)$ na família seja a função interpoladora do conjunto de pontos dados, precisamos que
  \begin{equation*}
    \begin{array}{l}
      a + bx_1 = y_1\\
      a + bx_2 = y_2
    \end{array}\quad\text{i.e.}\quad
    \begin{array}{l}
      a + b = 1\\
      a + 2b = 2
    \end{array}
  \end{equation*}
o que nos fornece $a = 0$ e $b = 1$. Então, a função interpoladora é $f(x) = x$. Os pontos e a reta interpolada estão esboçados na Figura~\ref{fig:ex_intro_interp}.
\end{ex}

Um problema de interpolação cuja a família de funções constitui-se de polinômios é chamado de problema de interpolação polinomial.

\section{Interpolação polinomial}\index{interpolação!polinomial}

Interpolação polinomial é um caso particular do problema geral de interpolação, no qual a família de funções é constituída de polinômios. Para o problema ser bem determinado é necessário restringirmos o grau dos polinômios. 

Observe que para o problema ser bem determinado, é necessário restringirmos o grau dos polinômios. Dado um conjunto de $n$ pontos a serem interpolados $\{(x_i,y_i)\}_{i=1}^{n}$, $x_i\neq x_j$ para $i\neq j$, a família de polinômios $\mathcal{F} = \mathbb{P}_{n-1}$ deve ser escolhida, onde:
\begin{equation*}
  \mathbb{P}_{n-1} := \{p(x) = a_1 + a_2x + \cdots + a_nx^{n-1}; a_i\in\mathbb{R}, i=1,2,\dotsc, n\},
\end{equation*}
i.e., a família dos polinômios reais de grau menor ou igual a $n-1$.

O Exemplo~\ref{ex:intro_interpolacao} discute um dos casos mais simples de interpolação polinomial, o qual consiste em interpolar uma reta por dois pontos. Neste caso, a família de funções consiste de polinômios de grau 1. Se buscarmos interpolar uma parábola pelos dois pontos dados, o problema fica subdeterminado, pois existem infinitas parábolas que passam por dois pontos dados. Além disso, se buscarmos interpolar uma reta por três pontos dados, o problema estaria sobredeterminado e poderia não ter solução se os pontos não fossem colineares. Veja o Exercício~\ref{exer:problemas_mal_determinados}.

Assim, dado um conjunto com $n$ pontos $\{(x_i,y_i)\}_{i=1}^{n}$, chamamos de \emph{polinômio interpolador}\index{polinômio interpolador} o polinômio de grau menor ou igual a $n-1$ que interpola os pontos dados.


\begin{figure}
  \centering
  \includegraphics{./cap_interp/pics/ex_interpolacao_polinomial/ex_interpolacao_polinomial}
  \caption{Polinômio interpolador do conjunto de pontos $\{(0, 1)$, $(1, 2)$, $(2, 4)$, $(3, 8)\}$. Veja o Exemplo~\ref{ex:interpolacao_polinomial}.}\label{fig:ex_interpolacao_polinomial}
\end{figure}

\begin{ex}\label{ex:interpolacao_polinomial} Encontre o polinômio interpolador do conjunto de pontos $\{(0, 1)$, $(1, 2)$, $(2, 4)$, $(3, 8)\}$.
\end{ex}
\begin{sol}
Como o conjunto consiste de 4 pontos, o polinômio interpolador deve ser da forma:
\begin{equation*}
  p(x) = a_1 + a_2x + a_3x^2 + a_4x^3.
\end{equation*}
As condições de interpolação são $p(x_i) = y_i$, $i = 1, 2, 3, 4$, o que nos leva ao sistema linear:
\begin{equation*}
  \begin{array}{lclclclcl}
    a_1& & & & & & &=&1\\
    a_1&+& a_2&+& a_3&+&  a_4&=&2\\
    a_1&+&2a_2&+&4a_3&+& 8a_4&=&4\\
    a_1&+&3a_2&+&9a_3&+&27a_4&=&8
  \end{array}
\end{equation*}
cuja solução é $a_1=1$, $a_2=\frac{5}{6}$, $a_3=0$ e $a_4=\frac{1}{6}$. Portanto, o polinômio interpolador é $p(x)=1+\frac{5}{6}x+\frac{1}{6}x^3$. Veja Figura~\ref{fig:ex_interpolacao_polinomial}.

%%%%%%%%%%%%%%%%%%%%
% scilab
%%%%%%%%%%%%%%%%%%%%
\ifisscilab
No \verb+Scilab+, podemos encontrar o polinômio interpolador e esboçar seu gráfico com os seguintes comandos:
\begin{verbatim}
-->xi = [0 1 2 3]';
-->yi = [1 2 4 8]'; 
-->A = [xi.^0 xi.^1 xi.^2 xi.^3]; 
-->a = inv(A)*yi; 
-->p = poly(a,'x','c') 
 p  =
                               3  
    1 + 0.8333333x + 0.1666667x   
-->xx = linspace(-0.5,3.25); 
-->plot(xi,yi,'ro',xx,horner(p,xx),'b-');xgrid
\end{verbatim}
\fi
%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%
% python
%%%%%%%%%%%%%%%%%%%%
\ifispython
Em \verb+Python+, podemos encontrar o polinômio interpolador e esboçar seu gráfico com os seguintes comandos:
\begin{verbatim}
>>> xi = np.array([0,1,2,3], dtype='double')
>>> yi = np.array([1,2,4,8], dtype='double')
>>> A = np.array([xi**3,xi**2,xi**1,xi**0]).transpose()
>>> a = np.linalg.inv(A).dot(yi);a
array([ 0.16666667,  0.        ,  0.83333333,  1.        ])
>>> xx = np.linspace(-0.5,3.25); 
>>> plt.plot(xi,yi,'ro',xx,np.polyval(a,xx),'b-')
>>> plt.grid();plt.show()
\end{verbatim}
\fi
%%%%%%%%%%%%%%%%%%%%
\end{sol}


\begin{teo}\label{teo:interp_poli} Seja $\{(x_i,y_i)\}_{i=1}^{n}$ um conjunto de $n$ pares ordenados de números reais tais que $x_i \ne x_j$ se $i\ne j$, então existe um único polinômio $p(x)$ de grau $n-1$ ou inferior que passa por todos os pontos dados, isto é, $p(x_i)=y_i, i=1,\ldots, n$.
\end{teo}
\begin{proof} Observe que o problema de encontrar os coeficientes $a_1$, $a_2$,\ldots, $a_n$ do polinômio
$$p(x)=a_1+a_2x+a_3x^2+\cdots a_nx^{n-1}=\sum_{k=1}^n a_k x^{k-1}$$
tal que $p(x_i)=y_i$ é equivalente a resolver o sistema linear com $n$ equações e $n$ incógnitas dado por
\begin{eqnarray*}
a_1+a_2x_1+a_3x_1^2+\cdots +a_n x_1^{n-1}&=&y_1,\\
a_1+a_2x_2+a_3x_2^2+\cdots +a_n x_2^{n-1}&=&y_2,\\
&\vdots&\\
a_1+a_2x_n+a_3x_n^2+\cdots +a_n x_n^{n-1}&=&y_n.
\end{eqnarray*}
O qual pode ser escrito na forma matricial como
$$\begin{bmatrix}
1 & x_1 & x_1^2 & \cdots & x_1^{n-1}\\
1 & x_2 & x_2^2 & \cdots & x_2^{n-1}\\
1 & x_3 & x_3^2 & \cdots & x_3^{n-1}\\
\vdots&\vdots&\vdots&\ddots&\vdots\\
1 & x_n & x_n^2 & \cdots & x_n^{n-1}
\end{bmatrix}
\begin{bmatrix}
a_1\\a_2\\a_3\\ \vdots \\a_n
\end{bmatrix}=
\begin{bmatrix}
y_1\\y_2\\y_3\\ \vdots \\y_n
\end{bmatrix}
$$
A matriz envolvida é uma \emph{matriz de Vandermonde}\index{matriz de Vandermonde} de ordem $n$ cujo determinante é dado por
$$\prod_{1\leq i<j\leq n}\left(x_j-x_i\right)$$
É fácil ver que se as abscissas são diferentes dois a dois, então o determinante é não nulo. Disto decorre que a matriz envolvida é inversível e,portanto, o sistema possui uma solução e esta solução é única.
\end{proof}

% \begin{ex} Encontre o polinômio da forma $P(x)=a_0+a_1x+a_2x^2+a_3x^3$ que passa pelos pontos
% $$(0,0),(1,1),(2,4),(3,9)$$
% Este problema é equivalente ao seguinte sistema linear:
% \begin{eqnarray*}
% a_0&=&0\\
% a_0+a_1+a_2+a_3&=&1\\
% a_0+2a_1+4a_2+8a_3&=&4\\
% a_0+3a_1+9a_2+27a_3&=&9
% \end{eqnarray*}
% cuja solução é $a_0=0$, $a_1=0$, $a_2=1$ e $a_3=0$. Portanto
% $$P(x)=x^2$$
% \end{ex}

Esta abordagem direta que usamos no Exemplo~\ref{ex:interpolacao_polinomial} e na demonstração do Teorema~\ref{teo:interp_poli} se mostra ineficiente quando o número de pontos é grande e quando existe grande variação nas abscissas. Neste caso a matriz de Vandermonde é mal condicionada (ver \cite{Gautschi}), acarretando um aumento dos erros de arredondamento na solução do sistema.

Uma maneira de resolver este problema é escrever o polinômio em uma base que produza um sistema bem condicionado.

\subsection*{Exercícios}

\begin{Exercise}\label{exer:interp1}
Encontre o polinômio interpolador para o conjunto de pontos $\{(-2, -47)$, $(0, -3)$, $(1, 4)$, $(2, 41)\}$. Então, faça um gráfico com os pontos e o polinômio interpolador encontrado.
\end{Exercise}
\begin{Answer}
  \begin{tiny}
    $p(x) = -3 + 2x + 5x^3$.
  \end{tiny}
\end{Answer}

\begin{Exercise}
  Encontre o polinômio interpolador para o conjunto de pontos $\{(-1, 1,25)$, $(0,5, 0,5)$, $(1, 1,25)$, $(1,25, 1,8125)\}$.
\end{Exercise}
\begin{Answer}
  \begin{tiny}
    $p(x) = 0,25 + x^2$.
  \end{tiny}
\end{Answer}

\begin{Exercise}\label{exer:problemas_mal_determinados}
  Mostre que:
  \begin{itemize}
  \item[a)] Existem infinitas parábolas que interpolam dois pontos dados $\{(x_1, y_1), (x_2, y_2)\}$, com $x_1 \neq x_2$.
  \item[b)] Não existe reta que interpola os pontos $\{(1, 1), (2, 2,1), (3, 3)\}$.
  \item[c)] Não existe parábola de equação $y = a_1 + a_2x + a_3x^2$ que interpola dois pontos dados $\{(x_1, y_1), (x_1, y_2)\}$, com $y_1 \neq y_2$. Mas, existem infinitas parábolas de equação $x = a_1 + a_2y + a_3y^2$ que interpolam estes pontos.
  \end{itemize}
\end{Exercise}
\begin{Answer}
  \begin{tiny}
  \begin{itemize}
  \item[a)] Uma parábola de equação $y = a_1 + a_2x + a_3x^2$ que interpola os pontos deve satisfazer o sistema:
    \begin{equation*}
      \begin{split}
      a_1 + a_2x_1 + a_3x_1^2 &= y_1\\
      a_1 + a_2x_2 + a_3x_2^2 &= y_2        
      \end{split}
    \end{equation*}
Sem perda de generalidade, para cada $a_3\in\mathbb{R}$ dado, temos:
    \begin{equation*}
      \begin{split}
      a_1 + a_2x_1  &= y_1 - a_3x_1^2\\
      a_1 + a_2x_2  &= y_2 - a_3x_2^2       
      \end{split},
    \end{equation*} 
o qual tem solução única, pois $x_1\neq x_2$. Ou seja, para cada $a_3\in\mathbb{R}$ dado, existem $a_1, a_2\in\mathbb{R}$ tais que a parábola de equação $y = a_1 + a_2x + a_3x^2$ interpola os pontos dados.
\item[b)] Certamente não existem retas de equação $x = a$ que interpolam os pontos dados. Consideremos então retas de equação $y = a_1 + a_2x$. Para uma tal reta interpolar os pontos dados é necessário que:
  \begin{equation*}
    \begin{split}
    a_1 + a_2 = 1\\
    a_1 + 2a_2 = 2,1\\
    a_1 + 3a_2 = 3      
    \end{split},
  \end{equation*}
o qual é um sistema impossível.
\item[c)] Não existe uma parábola de equação $y = a_1 + a_2x + a_3x^2$ que interpole os pontos dados, pois tal equação determina uma função de $x$ em $y$. Agora, para mostrar que existem infinitas parábolas de equação $x = a_1 + a_2y + a_3y^2$ que interpolam os pontos dados, basta seguir um raciocínio análogo ao do item a), trocando $x$ por $y$ e $y$ por $x$.
  \end{itemize}
  \end{tiny}
\end{Answer}


\section{Diferenças divididas de Newton}\index{diferenças divididas de Newton}
Dado um conjunto com $n$ pontos $\{(x_i, y_i)\}_{i=1}^n$, o \emph{método das diferenças divididas de Newton} consiste em construir o polinômio interpolador da forma
\begin{eqnarray*}
p(x) &=& a_1 + a_2 (x-x_1) + a_3 (x-x_1)(x-x_2) + \cdots \\
     &+& a_n (x-x_1)(x-x_2)\cdots (x-x_{n-1}).
\end{eqnarray*}
Como $p(x_i) = y_i$, $i=1, 2, \dotsc, n$, os coeficientes $a_i$ satisfazem o seguinte sistema triangular inferior:
\begin{small}
  \begin{equation*}
    \begin{array}{ll}
a_1               &= y_1\\
a_1+a_2(x_2-x_1)  &= y_2\\
a_1+a_2(x_3-x_1)+a_3(x_3-x_1)(x_3-x_2) &= y_3\\
&\vdots\\
a_1+a_2(x_n-x_1)+\cdots + a_n(x_n-x_1)\cdots (x_n-x_{n-1}) &= y_n
    \end{array}
  \end{equation*}
\end{small}
Resolvendo de cima para baixo, obtemos
\begin{equation*}\label{eq:coef_dif_div}
  \begin{split}
a_1&=y_1\\
a_2&=\frac{y_2-a_1}{x_2-x_1}=\frac{y_2-y_1}{x_2-x_1}\\
a_3&=\frac{y_3-a_2(x_3-x_1)-a_1}{(x_3-x_1)(x_3-x_2)}=\frac{\frac{y_3-y_2}{(x_3-x_2)}-\frac{y_2-y_1}{(x_2-x_1)}}{(x_3-x_1)}\\
&\ldots    
  \end{split}
\end{equation*}

Note que os coeficientes são obtidos por diferenças das ordenadas divididas por diferenças das abscissas dos pontos dados. Para vermos isso mais claramente, introduzimos a seguinte notação:
\begin{eqnarray*}
f[x_j]&:=&y_j\\
f[x_j, x_{j+1}]&:=&\frac{f[x_{j+1}]-f[x_j]}{x_{j+1}-x_j}\\
f[x_j, x_{j+1}, x_{j+2}]&:=&\frac{f[x_{j+1}, x_{j+2}]-f[x_j, x_{j+1}]}{x_{j+2}-x_j}\\
&\vdots&\\
f[x_j, x_{j+1}, \dotsc, x_{j+k}] &:=& \frac{f[x_{j+1}, x_{j+2}, \dotsc, x_{j+k}]-f[x_j, x_{j+1}, \dotsc, x_{j+k-1}]}{x_{j+k}-x_j}
\end{eqnarray*}
Chamamos $f[x_j]$ de diferença dividida de ordem zero (ou primeira diferença dividida), $f[x_i,x_j+1]$ de diferença dividida de ordem 1 (ou segunda diferença dividida) e assim por diante.

Uma inspeção cuidadosa dos coeficientes obtidos em \eqref{eq:coef_dif_div} nos mostra que
\begin{equation*}
 a_k=f[x_1,x_2,\ldots,x_k] 
\end{equation*}
Isto nos permite esquematizar o método conforme apresentado na Tabela~\ref{tab:esquema_difdiv}. 

\begin{table}
  \centering
$$
\begin{array}{c||c|ccc}\hline
j &x_j&f[x_j]&f[x_{j-1},x_j]&f[x_{j-2},x_{j-1},x_j]\\\hline
1 & x_1 & \pmb{f[x_1]}&&\\
&&&\pmb{f[x_1,x_2]}=\frac{f[x_2]-f[x_1]}{x_2-x_1}&\\
2 & x_2&f[x_2]&&\pmb{f[x_1,x_2,x_3]}=\frac{f[x_2,x_3]-f[x_1,x_2]}{x_3-x_1}\\
&&&f[x_2,x_3]=\frac{f[x_3]-f[x_2]}{x_3-x_2}&\\
3 & x_2&f[x_2]&&\\\hline
\multicolumn{5}{c}{}
\end{array}
$$
  \caption{Esquema de diferenças divididas para um conjunto com três pontos $\{(x_i, y_i)\}_{i=1}^3$.}
  \label{tab:esquema_difdiv}
\end{table}

\begin{ex}
Use o método de diferenças divididas para encontrar o polinômio que passe pelos pontos $(-1,3),(0,1),(1,3),(3,43)$.
\end{ex}
\begin{sol}
Usando o esquema apresentado na Tabela~\ref{tab:esquema_difdiv}, obtemos
\begin{equation*}
\begin{array}{c||c|cccc}\hline
 j&x_j&f[x_j]&f[x_{j-1},x_j]&f[x_{j-2},x_{j-1},x_j]&f[x_{j-3},x_{j-2},x_{j-1},x_j]\\\hline
1& -1 & \pmb{3}&&&\\
&&&\frac{1-3}{0-(-1)}=\pmb{-2}&&\\
2&0&1&&\frac{2-(-2)}{1-(-1)}=\pmb{2}&\\
&&&\frac{3-1}{1-0}=2&&\frac{6-2}{3-(-1)}=\pmb{1}\\
3&1&3&&\frac{20-2}{3-0}=6&\\
&&&\frac{43-3}{3-1}=20&&\\
4&3&43&&&\\\hline
\multicolumn{5}{c}{}
\end{array}  
\end{equation*}
Portanto, o polinômio interpolador do conjunto de pontos dados é
\begin{eqnarray*}
p(x)&=&3-2(x+1)+2(x+1)x+(x+1)x(x-1)
\end{eqnarray*}
ou, equivalentemente, $p(x) = x^3+2x^2-x+1$.
\end{sol}

\section{Polinômios de Lagrange}\index{polinômios!de Lagrange}
Outra maneira clássica de resolver o problema da interpolação polinomial é através dos polinômios de Lagrange. Dado um conjunto de pontos $\{x_j\}_{j=1}^n$ distintos dois a dois, definimos os polinômios de Lagrange como os polinômios de grau $n-1$ que satisfazem
$$
L_k(x_j)=\left\{\begin{array}{rl}
1,& \text{se }k=j\\
0,& \text{se }k\neq j
\end{array}
\right.
$$
Assim, o polinômio de grau $n-1$ que interpola os pontos dados, tais $p(x_j)=y_j, j=1,\ldots,n$ é dado por
$$p(x)=y_1L_1(x)+y_2L_2(x)+\cdots +y_nL_n(x)=\sum_{k=1}^n y_k L_k(x)$$

Para construir os polinômios de Lagrange, podemos analisar a sua forma fatorada, ou seja:
$$L_k(x)=c_k\prod_{\substack{j=1\\j\ne i}}^{n} (x-x_j)$$
onde o coeficiente $c_k$ é obtido da condição $L_k(x_k)=1$:
$$L_k(x_k)=c_k\prod_{\substack{j=1\\j\ne i}}^{n} (x_k-x_j) \Longrightarrow  c_k=\frac{1}{\displaystyle \prod_{\substack{j=1\\j\ne i}}^{n} (x_k-x_j)}$$
Portanto,
$$L_k(x)=\prod_{\substack{j=1\\j\ne i}}^{n} \frac{(x-x_j)}{(x_k-x_j)}$$

\begin{obs} O problema de interpolação quando escrito usando como base os polinômios de Lagrange produz um sistema linear diagonal.
\end{obs}

\begin{ex}Encontre o polinômio da forma $p(x)=a_1+a_2x+a_3x^2+a_4x^3$ que passa pelos pontos $(0, 0)$, $(1, 1)$, $(2, 4)$, $(3, 9)$.
Escrevemos:
\begin{eqnarray*}
L_1(x)&=& \frac{(x-1)(x-2)(x-3)}{(0-1)(0-2)(0-3)}=-\frac{1}{6}x^3+x^2-\frac{11}{6}x+1\\
L_2(x)&=& \frac{x(x-2)(x-3)}{1(1-2)(1-3)}=\frac{1}{2}x^3-\frac{5}{2}x^2+3x\\
L_3(x)&=& \frac{x(x-1)(x-3)}{2(2-1)(2-3)}=-\frac{1}{2}x^3+2x^2-\frac{3}{2}x\\
L_4(x)&=& \frac{x(x-1)(x-2)}{3(3-1)(3-2)}=\frac{1}{6}x^3-\frac{1}{2}x^2+\frac{1}{3}x
\end{eqnarray*}
Assim temos:
\begin{equation*}
  P(x)=0\cdot L_1(x)+1\cdot L_2(x)+4\cdot L_3(x)+9\cdot L_4(x)=x^2
\end{equation*}

%%%%%%%%%%%%%%%%%%%%
% python
%%%%%%%%%%%%%%%%%%%%
\ifispython
Em \verb+Python+, podemos usar a função \href{https://docs.scipy.org/doc/numpy/reference/generated/numpy.poly.html}{numpy.poly}, por exemplo:
\begin{verbatim}
>>> xi = np.array([0,1,2,3], dtype='double')
>>> yi = np.array([0,1,4,9], dtype='double')
>>> L1 = np.poly([xi[1],xi[2],xi[3]]);L1=L1/np.polyval(L1,xi[0]);L1
array([-0.16666667,  1.        , -1.83333333,  1.        ])
>>> L2 = np.poly([xi[0],xi[2],xi[3]]);L2=L2/np.polyval(L2,xi[1]);L2
array([ 0.5, -2.5,  3. ,  0. ])
>>> L3 = np.poly([xi[0],xi[1],xi[3]]);L3=L3/np.polyval(L3,xi[2]);L3
array([-0.5,  2. , -1.5, -0. ])
>>> L4 = np.poly([xi[0],xi[1],xi[2]]);L4=L4/np.polyval(L4,xi[3]);L4
array([ 0.16666667, -0.5       ,  0.33333333,  0.        ])
>>> a = yi[0]*L1 + yi[1]*L2 + yi[2]*L3 + yi[3]*L4;a
array([ 0.,  1.,  0.,  0.])
\end{verbatim}
Para plotar os pontos e o polinômio interpolador, podemos usar:
\begin{verbatim}
>>> xx = np.linspace(-0.25,3.25)
>>> plt.plot(xi,yi,'ro',xx,np.polyval(a,xx),'b-')
>>> plt.grid();plt.show()
\end{verbatim}
\fi
%%%%%%%%%%%%%%%%%%%%
\end{ex}

\begin{ex}Encontre o polinômio da forma $p(x)=a_1+a_2x+a_3x^2+a_4x^3$ que passa pelos pontos $(0, 0)$, $(1, 1)$, $(2, 0)$, $(3, 1)$.
\end{ex}
\begin{sol}
Como as abscissas são as mesmas do exemplo anterior, podemos utilizar os mesmos polinômios de Lagrange, assim temos:
\begin{equation*}
  p(x)=0\cdot L_1(x)+1\cdot L_2(x)+0\cdot L_3(x)+1\cdot L_4(x)=\frac{2}{3}x^3-3x^2+\frac{10}{3}x.
\end{equation*}
\end{sol}

\section{Aproximação de funções reais por polinômios interpoladores}\index{aproximação!de funções!por polinômios}

\begin{teo}\label{teo_interp}
Dados $n+1$ pontos distintos, $x_0,\ x_1,\ \cdots,\ x_n$, dentro de um intervalo $[a,b]$ e uma função $f$ com $n+1$ derivadas contínuas nesse intervalo ($f\in C^{n+1}[a,b]$), então para cada $x$ em $[a,b]$, existe um número $\xi(x)$ em $(a,b)$ tal que
$$
f(x)=P(x)+\frac{f^{(n+1)}(\xi(x))}{(n+1)!}(x-x_0)(x-x_1)\cdots(x-x_n),
$$
onde $P(x)$ é o polinômio interpolador. Em especial, pode-se dizer que
$$
|f(x)-P(x)|\leq \frac{M}{(n+1)!}\left|(x-x_0)(x-x_1)\cdots(x-x_n)\right|,
$$
onde
$$
M=\max_{x\in[a,b]}|f^{(n+1)}(\xi(x))|
$$
\end{teo}

\begin{ex}
Considere a função $f(x)=\cos(x)$ e o polinômio $P(x)$ de grau 2 tal que $P(0)=\cos(0)=1$, $P(\frac{1}{2})=\cos(\frac{1}{2})$ e $P(1)=\cos(1)$. Use a fórmula de Lagrange para encontrar $P(x)$. Encontre o erro máximo que se assume ao aproximar o valor de $\cos(x)$ pelo de $P(x)$ no intervalo $[0,1]$. Trace os gráficos de $f(x)$ e $P(x)$ no intervalo $[0,1]$ no mesmo plano cartesiano e, depois, trace o gráfico da diferença $\cos(x)-P(x)$. Encontre o erro efetivo máximo $|\cos(x)-P(x)|$.
\end{ex}

\begin{eqnarray*}
P(x)&=&1\frac{(x-\frac{1}{2})(x-1)}{(0-\frac{1}{2})(0-1)}+\cos\left(\frac{1}{2}\right)\frac{(x-0)(x-1)}{(\frac{1}{2}-0)(\frac{1}{2}-1)}+\cos(1)\frac{(x-0)(x-\frac{1}{2})}{(1-0)(1-\frac{1}{2})}\\
&\approx&   1 - 0,0299720583066x - 0,4297256358252x^2
\end{eqnarray*}

%%%%%%%%%%%%%%%%%%%%
% scilab
%%%%%%%%%%%%%%%%%%%%
\ifisscilab
\begin{verbatim}
L1=poly([.5 1],'x');L1=L1/horner(L1,0)
L2=poly([0 1],'x');L2=L2/horner(L2,0.5)
L3=poly([0 .5],'x');L3=L3/horner(L3,1)
P=L1+cos(.5)*L2+cos(1)*L3
x=[0:.05:1]
plot(x,cos)
plot(x,horner(P,x),'red')
plot(x,horner(P,x)-cos(x))
\end{verbatim}
\fi
%%%%%%%%%%%%%%%%%%%%

Para encontrar o erro máximo, precisamos estimar $|f'''(x)|=|\sin(x)|\leq \sin(1)<0,85$ e
$$
\max_{x\in[0,1]} \left|x\left(x-\frac{1}{2}\right)(x-1)\right|
$$
O polinômio de grau três $Q(x)=x\left(x-\frac{1}{2}\right)(x-1)$ tem um mínimo (negativo) em $x_1=\frac{3+\sqrt{3}}{6}$ e um máximo (positivo) em $x_2=\frac{3-\sqrt{3}}{6}$. Logo:
$$
\max_{x\in[0,1]} \left|x\left(x-\frac{1}{2}\right)(x-1)\right|\leq \max\{|Q(x_1)|,\ |Q(x_2)|\}\approx 0,0481125.
$$
Portanto:
$$
|f(x)-P(x)|< \frac{0,85}{3!}0,0481125\approx 0,0068159<7\cdot 10^{-3}
$$

Para encontrar o erro efetivo máximo, basta encontrar o máximo de $|P(x)-cos(x)|$. O mínimo (negativo) de $P(x)-cos(x)$ acontece em $x_1=4,29\cdot 10^{-3}$ e o máximo (positivo) acontece em $x_2=3,29\cdot 10^{-3}$. Portanto, o erro máximo efetivo é $4,29\cdot 10^{-3}$.

\begin{ex}\label{exemp_simpson}
Considere o problema de aproximar o valor da integral $\int_0^1 f(x)dx$ pelo valor da integral do polinômio $P(x)$ que coincide com $f(x)$ nos pontos $x_0=0$, $x_1=\frac{1}{2}$ e $x_2=1$. Use a fórmula de Lagrange para encontrar $P(x)$. Obtenha o valor de $\int_0^1f(x)dx$ e encontre uma expressão para o erro de truncamento.
\end{ex}
O polinômio interpolador de $f(x)$ é
\begin{eqnarray*}
P(x)&=&f(0)\frac{(x-\frac{1}{2})(x-1)}{(0-\frac{1}{2})(0-1)}+f\left(\frac{1}{2}\right)\frac{(x-0)(x-1)}{(\frac{1}{2}-0)(\frac{1}{2}-1)}+f(1)\frac{(x-0)(x-\frac{1}{2})}{(1-0)(1-\frac{1}{2})}\\
&=&   f(0)(2x^2-3x+1)+f\left(\frac{1}{2}\right)(-4x^2+4x)+f(1)(2x^2-x)
\end{eqnarray*}
e a integral de $P(x)$ é:
\begin{eqnarray*}
\int_0^1 P(x)dx &=& \left[f(0)\left(\frac{2}{3}x^3 - \frac{3}{2}x^2+x\right)\right]_0^1 + \left[f\left(\frac{1}{2}\right)\left(-\frac{4}{3}x^3+2x^2\right)\right]_0^1 \\
&+& \left[f(1)\left(\frac{2}{3}x^3-\frac{1}{2}x^2\right)\right]_0^1\\
&=& f(0)\left(\frac{2}{3}-\frac{3}{2}+1\right)+f\left(\frac{1}{2}\right)\left(-\frac{4}{3}+2\right)+f(1)\left(\frac{2}{3}-\frac{1}{2}\right)\\
&=& \frac{1}{6}f(0)+\frac{2}{3}f\left(\frac{1}{2}\right)+\frac{1}{6}f(1)
\end{eqnarray*}
Para fazer a estimativa de erro usando o Teorema~\ref{teo_interp}, e temos
\begin{eqnarray*}
\left|\int_0^1f(x)dx-\int_0^1 P(x)dx\right|&=&\left|\int_0^1f(x)- P(x)dx\right|\\
&\leq&\int_0^1|f(x)- P(x)|dx\\
&\leq& \frac{M}{6}  \int_0^1\left|x\left(x-\frac{1}{2}\right)(x-1)\right|dx\\
&=& \frac{M}{6}  \left[\int_0^{1/2}x\left(x-\frac{1}{2}\right)(x-1)dx\right.\\
&-&\left.\int_{1/2}^1x\left(x-\frac{1}{2}\right)(x-1)dx\right]\\
&=& \frac{M}{6}  \left[\frac{1}{64}-\left(-\frac{1}{64}\right)\right]=\frac{M}{192}.
\end{eqnarray*}
Lembramos que $M=\max_{x\in[0,1]}|f'''(x)|$.

\begin{obs}Existem estimativas melhores para o erro de truncamento para este esquema de integração numérica. Veremos com mais detalhes tais esquemas na teoria de integração numérica.
\end{obs}

\begin{ex}
Use o resultado do exemplo anterior para aproximar o valor das seguintes integrais:\\

a) $\displaystyle \int_0^1 \ln(x+1) dx$\\

b) $\displaystyle \int_0^1 e^{-x^2}dx$

\end{ex}
\begin{sol}
Usando a fórmula obtida, temos que
$$
\int_0^1\ln(x+1) dx \approx 0,39\pm \frac{1}{96}
$$
$$
\int_0^1 e^{-x^2} dx \approx 0,75\pm \frac{3,87}{192}
$$  
\end{sol}

\subsection*{Exercícios}

\begin{Exercise}
  Use as mesmas técnicas usadas o resultado do Exemplo~\ref{exemp_simpson} para obter uma aproximação do valor de:
  \begin{equation*}
    \int_0^1 f(x)dx
  \end{equation*}
através do polinômio interpolador que coincide com $f(x)$ nos pontos $x=0$ e $x=1$.
\end{Exercise}
\begin{Answer}
  \begin{tiny}
  $\int_0^1 P(x)dx =\frac{f(0)+f(1)}{2}$, $\frac{1}{12}\max_{x\in[0,1]}|f''(x)|$  
  \end{tiny}
\end{Answer}

\section{Interpolação linear segmentada}\index{interpolação!linear segmentada}
Considere o conjunto $\left(x_i,y_i\right)_{j=1}^n$ de $n$ pontos. Assumiremos que $x_{i+1}>x_i$, ou seja, as abscissas são distintas e estão em ordem crescente. A função linear que interpola os pontos $x_i$ e $x_{i+1}$ no intervalo $i$ é dada por
$$P_i(x)=y_i \frac{(x_{i+1}-x)}{(x_{i+1}-x_i)} + y_{i+1} \frac{(x-x_i)}{(x_{i+1}-x_i)}$$

O resultado da interpolação linear segmentada é a seguinte função contínua definida por partes no intervalo $[x_1,x_n]$:
$$f(x)=P_i(x), ~~~~ x\in [x_i,x_{i+1}]$$

\begin{ex}
  Construa uma função linear por partes que interpola os pontos $(0,0)$, $(1,4)$, $(2,3)$, $(3,0)$, $(4,2)$, $(5,0)$.

A função procurada pode ser construída da seguinte forma:
\begin{equation*}
  f(x) = \left\{
    \begin{array}{ll}
      0\frac{x-1}{0-1} + 1\frac{x-0}{1-0} &, 0 \leq x < 1\\
      4\frac{x-2}{1-2} + 3\frac{x-1}{2-1} &, 1\leq x < 2\\
      3\frac{x-3}{2-3} + 0\frac{x-2}{3-2} &, 2\leq x \leq 3
    \end{array}
\right.
\end{equation*}
Simplificando, obtemos:
\begin{equation*}
  f(x) = \left\{
    \begin{array}{ll}
      x &, 0 \leq x < 1\\
      -x + 5 &, 1\leq x < 2\\
      -3x + 9 &, 2\leq x \leq 3
    \end{array}
\right.  
\end{equation*}
\end{ex}

A Figura \ref{fig:linear_segmentada} é um esboço da função $f(x)$ obtida. 
\ifisscilab
Ela foi gerada no \verb+Scilab+ usando os comandos:
\verbatiminput{./cap_interp/codes/interpolacao_linear_segmentada/ex_linear_segmentada.sce}
\fi

\begin{figure}[htp]
  \begin{center}
    \includegraphics[scale=0.5]{./cap_interp/pics/interpolacao_linear_segmentada.eps}
    \caption{Interpolação linear segmentada.}
    \label{fig:linear_segmentada}
  \end{center}
\end{figure}


\section{Interpolação cúbica segmentada - spline}\index{interpolação!cúbica segmentada}\index{spline}
Dado um conjunto de $n$ pontos $\left(x_j,y_j\right)_{j=1}^n$ tais que $x_{j+1}>x_j$, ou seja, as abscissas são distintas e estão em ordem crescente; um spline cúbico que interpola estes pontos é uma função $s(x)$ com as seguintes propriedades:
\begin{itemize}
\item[i] Em cada segmento $[x_j,x_{j+1}]$, $j=1,2,\ldots n-1$ $s(x)$ é um polinômio cúbico.
\item[ii] para cada ponto, $s(x_j)=y_j$, i.e., o spline interpola os pontos dados.
\item[iii] $s(x)\in C^2$, i.e., é função duas vezes continuamente diferenciável.
\end{itemize}

Da primeira hipótese, escrevemos
$$s(x)=s_j(x),x \in [x_j,x_{j+1}],~~ j=1,\ldots, n-1$$
com
$$s_j(x)=a_j+b_j(x-x_j)+c_j(x-x_j)^2+d_j(x-x_j)^3$$
O problema agora consiste em obter os 4 coeficientes de cada um desses $n-1$ polinômios cúbicos.

Veremos que a simples definição de spline produz $4n-6$ equações linearmente independentes:
\begin{equation*}
\begin{array}{rcll}
s_j(x_j)&=&y_j,~~ &j=1,\ldots, n-1\\
s_{j}(x_{j+1})&=&y_{j+1},~~ &j=1,\ldots, n-1\\
s_{j}'(x_{j+1})&=&s_{j+1}'(x_{j+1}),~~ &j=1,\ldots, n-2\\
s_{j}''(x_{j+1})&=&s_{j+1}''(x_{j+1}),~~ &j=1,\ldots, n-2
\end{array}
\end{equation*}
Como
\begin{equation}\label{eq_1derivada}
s'_j(x)=b_j+2c_j(x-x_j)+3d_j(x-x_j)^2
\end{equation}
e
\begin{equation}\label{eq_2derivada}
s''_j(x)=2c_j+6d_j(x-x_j),
\end{equation}
temos, para $j=1,\ldots, n-1$, as seguintes equações
\begin{equation*}
\begin{array}{rcl}
a_j&=&y_j,\\
a_j+b_j(x_{j+1}-x_j)+c_j(x_{j+1}-x_j)^2+d_j(x_{j+1}-x_j)^3&=&y_{j+1},\\
b_j+2c_j(x_{j+1}-x_j)+3d_j(x_{j+1}-x_j)^2&=&b_{j+1},\\
c_j+3d_j(x_{j+1}-x_j)&=&c_{j+1},
\end{array}
\end{equation*}
Por simplicidade, definimos
$$
h_j=x_{j+1}-x_j
$$
e temos
\begin{equation}
\begin{array}{rcl}
a_j&=&y_j,\\
a_j+b_jh_j+c_jh_j^2+d_jh_j^3&=&y_{j+1},\\
b_j+2c_jh_j+3d_jh_j^2&=&b_{j+1},\label{eq3}\\
c_j+3d_jh_j&=&c_{j+1},
\end{array}
\end{equation}
que podem ser escrita da seguinte maneira
\begin{equation}\label{eq_an_spline}
a_j=y_j,
\end{equation}
\begin{equation}\label{eq_dn_spline}
d_j=\frac{c_{j+1}-c_j}{3h_j},
\end{equation}
\begin{equation}\label{eq_bn_spline}
  \begin{split}
    b_j &= \frac{y_{j+1}-y_j-c_jh_j^2-\frac{c_{j+1}-c_j}{3h_j}h_j^3}{h_j},\\
    &= \frac{3y_{j+1}-3y_j-3c_jh_j^2-c_{j+1}h_j^2+c_jh_j^2}{3h_j}\\
    &= \frac{3y_{j+1}-3y_j-2c_jh_j^2-c_{j+1}h_j^2}{3h_j}
  \end{split}
\end{equation}
Trocando o índice $j$ por $j-1$ na terceira equação \eqref{eq3}, $j=2,\ldots, n-1$
\begin{equation}
b_{j-1}+2c_{j-1}h_{j-1}+3d_{j-1}h_{j-1}^2=b_{j}  
\end{equation}
e, portanto,
\begin{equation}
  \begin{split}
    \frac{3y_{j}-3y_{j-1}-2c_{j-1}h_{j-1}^2-c_{j}h_{j-1}^2}{3h_{j-1}} &+ 2c_{j-1}h_{j-1}+c_{j}h_{j-1}-c_{j-1}h_{j-1} \\
    &=\frac{3y_{j+1}-3y_j-2c_jh_j^2-c_{j+1}h_j^2}{3h_j}.      
  \end{split}
\end{equation}
Fazendo as simplificações, obtemos:
\begin{equation}\label{eq_cn_spline}
  c_{j-1}h_{j-1}+c_j(2h_j+2h_{j-1})+c_{j+1}h_j=3\frac{y_{j+1}-y_j}{h_j}-3\frac{y_{j}-y_{j-1}}{h_{j-1}}.
\end{equation}
É costumeiro acrescentar a incógnita $c_n$ ao sistema. A incógnita $c_n$ não está relacionada a nenhum dos polinômios interpoladores. Ela é uma construção artificial que facilita o cálculo dos coeficientes do spline. Portanto, a equação acima pode ser resolvida para $j=2, \ldots, n-1$.

Para determinar unicamente os $n$ coeficientes $c_n$ precisamos acrescentar duas equações linearmente independentes às $n-2$ equações dadas por \eqref{eq_cn_spline}. Essas duas equações adicionais definem o tipo de spline usado.

\subsection{Spline natural}\index{spline!natural}

Uma forma de definir as duas equações adicionais para completar o sistema \eqref{eq_cn_spline} é impor condições de fronteira livres (ou naturais), ou seja,
\begin{equation}
S''(x_1)=S''(x_n)=0.
\end{equation}
Substituindo na equação \eqref{eq_2derivada}
$$
s''_1(x_1)=2c_1+6d_1(x_1-x_1)=0 \Longrightarrow c_1=0.
$$
e
$$
s''_{n-1}(x_n)=2c_{n-1}+6d_{n-1}(x_{n}-x_{n-1})=0 .
$$
Usando o fato que
$$
c_{n-1}+3d_{n-1}h_{n-1}=c_{n}
$$
temos que
$$
c_n=-3d_{n-1}(x_{n}-x_{n-1})+3d_{n-1}h_{n-1}=0.
$$
Essa duas equações para $c_1$ e $c_n$ juntamente com as equações \eqref{eq_cn_spline} formam um sistema de $n$ equações $Ac=z$, onde
\begin{equation}
A=\left[\begin{array}{ccccccc}
1 &0&0&0 &\cdots&0&0\\
h_1&2h_2+2h_{1}&h_2&0&\cdots&0&0\\
0&h_2&2h_3+2h_{2}&h_3&\cdots&0&0\\
\vdots&\vdots&\vdots&\vdots&\ddots&\vdots&\vdots\\
0&0&0&\cdots&h_{n-2} & 2h_{n-2}+2h_{n-1}&h_{n-1}\\
0&0&0&\cdots &0&0&1
\end{array}\right]  
\end{equation}
\begin{equation}
c = \left[\begin{array}{c}
c_1\\
c_2\\
\vdots\\
c_n
\end{array}\right]\qquad \hbox{e}\qquad
z = \left[\begin{array}{c}
0\\
3\frac{y_{3}-y_2}{h_2}-3\frac{y_{2}-y_{1}}{h_{1}}\\
3\frac{y_{4}-y_3}{h_3}-3\frac{y_{3}-y_{2}}{h_{2}}\\
\vdots\\
3\frac{y_{n-1}-y_{n-2}}{h_{n-2}}-3\frac{y_{n-2}-y_{n-3}}{h_{n-3}}\\
0
\end{array}\right]
\end{equation}
Observe que a matriz $A$ é diagonal dominante estrita e, portanto, o sistema $Ac=z$ possui solução única. Calculado $c$, os valores dos $a_n$, $b_n$ e $d_n$ são obtidos diretamente pelas expressões \eqref{eq_an_spline}, \eqref{eq_bn_spline} e \eqref{eq_dn_spline}, respectivamente.

\begin{ex}Construa um spline cúbico natural que passe pelos pontos $(2,~4,5)$, $(5,-1,9)$, $(9,~0,5)$ e $(12,-0,5)$.
\end{ex}
\begin{sol}
O spline desejado é uma função definida por partes da forma:
\begin{equation}
S(x)=\left\{\begin{array}{ll}
    a_1+b_1(x-2)+c_1(x-2)^2+d_1(x-2)^3 &, 2\leq x <5\\
    a_2+b_2(x-5)+c_2(x-5)^2+d_2(x-5)^3 &, 5\leq x <9\\
    a_3+b_3(x-9)+c_3(x-9)^2+d_3(x-9)^3 &, 9\leq x \leq 12
\end{array}\right..  
\end{equation}
Os coeficientes $c_1$, $c_2$ e $c_3$ resolvem o sistema $Ac = z$, onde
\begin{equation*}
A = \begin{bmatrix}
  1 &0&0&0 \\
  3&2\cdot 3+2\cdot 4&4&0\\
  0&4&2\cdot 4+2\cdot 3&3\\
  0&0&0&1
\end{bmatrix} = \begin{bmatrix}
  1 &0&0&0 \\
  3&14&4&0\\
  0&4&14&3\\
  0&0&0&1
\end{bmatrix}  
\end{equation*}
\begin{equation*}
c = \begin{bmatrix}
c_1\\
c_2\\
c_3\\
c_4
\end{bmatrix} \quad \hbox{e}\quad
z = \begin{bmatrix}
0\\
3\frac{0,5-(-1,9)}{4}-3\frac{(-1,9)-4,5}{3}\\
3\frac{-0,5-0,5}{3}-3\frac{0,5-(-1,9)}{4}\\
0
\end{bmatrix} = \begin{bmatrix}
0\\
8,2\\
-2,8\\
0
\end{bmatrix}  
\end{equation*}
Observe que $c_4$ é um coeficiente artificial para o problema. A solução é  $c_1=0$, $c_2=0,7$, $c_3=-0,4$ e $c_4=0$. Calculamos os demais coeficientes usando as expressões \eqref{eq_an_spline}, \eqref{eq_bn_spline} e \eqref{eq_dn_spline}:
\begin{eqnarray*}
a_1&=&y_1=4,5\\
a_2&=&y_2=-1,9\\
a_3&=&y_3=0,5\\
\end{eqnarray*}
\begin{eqnarray*}
d_1&=&\frac{c_{2}-c_1}{3h_1}=\frac{0,7-0}{3\cdot 3}=0,0777778\\
d_2&=&\frac{c_{3}-c_2}{3h_2}=\frac{-0,4-0,7}{3\cdot 4}=-0,0916667\\
d_3&=&\frac{c_{4}-c_3}{3h_3}=\frac{0+0,4}{3\cdot 3}=0,0444444
\end{eqnarray*}
\begin{eqnarray*}
b_1 &=& \frac{y_{2}-y_1}{h_1}-\frac{h_1}{3}(2c_1+c_{2})\\
&=& \frac{-1,9-4,5}{3}-\frac{3}{3}(2\cdot 0-0,7)=-2,8333333\\
b_2&=& \frac{y_{3}-y_2}{h_2}-\frac{h_2}{3}(2c_2+c_{3})\\
&=& \frac{0,5-(-1,9)}{4}-\frac{4}{3}(2\cdot 0,7+0,4)=-0,7333333\\
b_3&=& \frac{y_{4}-y_3}{h_3}-\frac{h_3}{3}(2c_3+c_{4})\\
&=& \frac{-0,5-0,5}{3}-\frac{3}{3}(2\cdot (-0,4)+0)=0,4666667
\end{eqnarray*}
Portanto:
\begin{small}
\begin{equation*}
S(x)=\left\{\begin{array}{ll}
4,5-2,833(x-2)+0,078(x-2)^3 &\!, 2\leq x<5\\
-1,9-0,733(x-5)+0,7(x-5)^2-0,092(x-5)^3 &\!, 5\leq x<9\\
0,5+0,467(x-9)-0,4(x-9)^2+0,044(x-9)^3 &\!, 9\leq x\leq 12
\end{array}\right.
\end{equation*}  
\end{small}

\ifisscilab
No \verb+Scilab+, podemos utilizar:
\begin{verbatim}
X = [2 5 9 12]'
Y = [4.5 -1.9 0.5 -0.5]'
h = X(2:4)-X(1:3)
A = [1 0 0 0;h(1) 2*h(1)+2*h(2) h(2) 0; ...
   0 h(2) 2*h(2)+2*h(3) h(3);0 0 0 1 ]
z = [0, 3*(Y(3)-Y(2))/h(2)-3*(Y(2)-Y(1))/h(1), ...
   3*(Y(4)-Y(3))/h(3)-3*(Y(3)-Y(2))/h(2), 0]'
c = A\z
for i=1:3
   a(i) = Y(i)
   d(i) = (c(i+1)-c(i))/(3*h(i))
   b(i) = (Y(i+1)-Y(i))/h(i)-h(i)/3*(2*c(i)+c(i+1))
end

for i=1:3
    P(i) = poly([a(i) b(i) c(i) d(i)],'x','coeff')
    z = [X(i):.01:X(i+1)]
    plot(z,horner(P(i),z-X(i)))
end
\end{verbatim}
\fi
\end{sol}

\subsection{Spline fixado}\index{spline!fixado}

Alternativamente, para completar o sistema \eqref{eq_cn_spline}, podemos impor condições de contorno fixadas, ou seja,
\begin{eqnarray*}
S'(x_1)&=&f'(x_1)\\
S'(x_n)&=&f'(x_n).
\end{eqnarray*}
Substituindo na equação \eqref{eq_1derivada}
\begin{equation}
s'_1(x_1)=b_1+2c_1(x_1-x_1)+3d_j(x_1-x_1)^2=f'(x_1)\Longrightarrow b_1=f'(x_1)  
\end{equation}
e
\begin{equation}
  \begin{split}
s'_{n-1}(x_n) &= b_{n-1}+2c_{n-1}(x_n-x_{n-1})+3d_j(x_n-x_{n-1})^2 \\
&= b_{n-1}+2c_{n-1}h_{n-1}+3d_{n-1}h_{n-1}^2=f'(x_n)
  \end{split}
\end{equation}
Usando as equações \eqref{eq_dn_spline} e \eqref{eq_bn_spline} para $j=1$ e $j=n-1$, temos:
\begin{equation}
2c_1h_1+c_{2}h_1=3\frac{y_{2}-y_1}{h_1}-3f'(x_1)  
\end{equation}
e
\begin{equation}
c_{n-1}h_{n-1}+c_{n}h_{n-1}=3f'(x_n)-3\frac{y_{n}-y_{n-1}}{h_{n-1}}  
\end{equation}

Essas duas equações juntamente com as equações \eqref{eq_cn_spline} formam um sistema de $n$ equações $Ac = z$, onde
\begin{equation*}
A=\left[\begin{array}{ccccccc}
2h_1 &h_1&0&0 &\cdots&0&0\\
h_1&2h_2+2h_{1}&h_2&0&\cdots&0&0\\
0&h_2&2h_3+2h_{2}&h_3&\cdots&0&0\\
\vdots&\vdots&\vdots&\vdots&\ddots&\vdots&\vdots\\
0&0&0&\cdots&h_{n-2} & 2h_{n-2}+2h_{n-1}&h_{n-1}\\
0&0&0&\cdots &0&h_{n-1}&2h_{n-1}
\end{array}\right]  
\end{equation*}  
\begin{equation*}
c = \left[\begin{array}{c}
c_1\\
c_2\\
\vdots\\
c_n
\end{array}\right]\qquad \hbox{e}\qquad
z = \left[\begin{array}{c}
3\frac{y_{2}-y_1}{h_1}-3f'(x_1)\\
3\frac{y_{3}-y_2}{h_2}-3\frac{y_{2}-y_{1}}{h_{1}}\\
3\frac{y_{4}-y_3}{h_3}-3\frac{y_{3}-y_{2}}{h_{2}}\\
\vdots\\
3\frac{y_{n-1}-y_{n-2}}{h_{n-2}}-3\frac{y_{n-2}-y_{n-3}}{h_{n-3}}\\
3f'(x_n)-3\frac{y_{n}-y_{n-1}}{h_{n-1}}
\end{array}\right]  
\end{equation*}
Observe que a matriz $A$ é diagonal dominante estrita e, portanto, o sistema $Ac = z$ possui solução única. Calculado $c$, os valores dos $a_n$, $b_n$ e $d_n$ são obtidos diretamente pelas expressões \eqref{eq_an_spline}, \eqref{eq_bn_spline} e \eqref{eq_dn_spline}, respectivamente.


\begin{ex}Construa um spline cúbico com fronteira fixada que interpola a função $y=\sin (x)$ nos pontos $x=0$, $x=\frac{\pi}{2}$, $x=\pi$, $x=\frac{3\pi}{2}$ e $x=2\pi$.
\end{ex}
O spline desejado passa pelos pontos $(0,0)$, $(\pi/2,1)$, $(\pi,0)$, $(3\pi/2,-1)$ e $(2\pi,0)$ e tem a forma:
\begin{equation*}
S(x)=\left\{\begin{array}{ll}
a_1+b_1x+c_1x^2+d_1x^3&, 0\leq x<\frac{\pi}{2}\\
a_2+b_2(x-\frac{\pi}{2})+c_2(x-\frac{\pi}{2})^2+d_2(x-\frac{\pi}{2})^3&, \frac{\pi}{2}\leq x<\pi\\
a_3+b_3(x-\pi)+c_3(x-\pi)^2+d_3(x-\pi)^3&, \pi\leq x<\frac{3\pi}{2}\\
a_4+b_4(x-\frac{3\pi}{2})+c_4(x-\frac{3\pi}{2})^2+d_4(x-\frac{3\pi}{2})^3&, \frac{3\pi}{2}\leq x\leq 2\pi
\end{array}\right..  
\end{equation*}
Observe que ele satisfaz as condição de contorno $f'(0)=cos(0)=1$ e $f'(2\pi)=cos(2\pi)=1$.

Os coeficientes $c_1$, $c_2$, $c_3$ e $c_4$ resolvem o sistema $Ac = z$, onde:
\begin{equation*}
A=\left[\begin{array}{ccccc}
\pi &\pi/2&0&0&0 \\
\pi/2&2\pi&\pi/2&0&0\\
0&\pi/2&2\pi&\pi/2&0\\
0&0&\pi/2&2\pi&\pi/2\\
0&0&0&\pi/2&\pi\\
\end{array}\right]  
\end{equation*}
\begin{equation*}
c = \left[\begin{array}{c}
c_1\\
c_2\\
c_3\\
c_4\\
c_5
\end{array}\right]\qquad \hbox{e}\qquad
z = \left[\begin{array}{c}
3\frac{1-0}{\pi/2}-3\cdot 1\\
3\frac{0-1}{\pi/2}-3\frac{1-0}{\pi/2}\\
3\frac{-1-0}{\pi/2}-3\frac{0-1}{\pi/2}\\
3\frac{0-(-1)}{\pi/2}-3\frac{(-1)-0}{\pi/2}\\
3\cdot 1-3\frac{0-(-1)}{\pi/2}
\end{array}\right]=\left[\begin{array}{c}
6/\pi-3\\
-12/\pi\\
0\\
12/\pi\\
3-6/\pi
\end{array}\right]  
\end{equation*}
Aqui $c_5$ é um coeficiente artificial para o problema. A solução é  $c_1=-0,0491874$, $c_2=-0,5956302$, $c_3=0$, $c_4=0,5956302$ e $c_5=0,0491874$. Calculamos os demais coeficientes usando as expressões \eqref{eq_an_spline}, \eqref{eq_bn_spline} e \eqref{eq_dn_spline}:
\begin{eqnarray*}
a_1&=&y_1=0\\
a_2&=&y_2=1\\
a_3&=&y_3=0\\
a_4&=&y_3=-1\\
\end{eqnarray*}
\begin{eqnarray*}
d_1&=&\frac{c_{2}-c_1}{3h_1}=\frac{-0,5956302-(-0,0491874)}{3\cdot \pi/2}=-0,1159588\\
d_2&=&\frac{c_{3}-c_2}{3h_2}=\frac{0-(-0,5956302)}{3\cdot \pi/2}=0,1263967\\
d_3&=&\frac{c_{4}-c_3}{3h_3}=\frac{0,5956302- 0}{3\cdot \pi/2}=0,1263967\\
d_4&=&\frac{c_{5}-c_4}{3h_4}=\frac{0,0491874- 0,5956302}{3\cdot \pi/2}=-0,1159588
\end{eqnarray*}
\begin{eqnarray*}
b_1&=& \frac{y_{2}-y_1}{h_1}-\frac{h_1}{3}(2c_1+c_{2})\\
&=&\frac{1-0}{\pi/2}-\frac{\pi/2}{3}(2\cdot (-0,0491874)-0,5956302)=1\\
b_2&=&\frac{y_{3}-y_2}{h_2}-\frac{h_2}{3}(2c_2+c_{3})\\
&=&\frac{0-1}{\pi/2}-\frac{\pi/2}{3}(2\cdot(-0,5956302) +0)=-0,0128772\\
b_3&=&\frac{y_{4}-y_3}{h_3}-\frac{h_3}{3}(2c_3+c_{4})\\
&=&\frac{-1-0}{\pi/2}-\frac{\pi/2}{3}(2\cdot 0+0,5956302)=-0,9484910\\
b_4&=&\frac{y_{5}-y_4}{h_4}-\frac{h_4}{3}(2c_4+c_{5})\\
&=&\frac{0-(-1)}{\pi/2}-\frac{\pi/2}{3}(2\cdot 0,5956302+0,0491874)=-0,0128772
\end{eqnarray*}
Portanto,
\begin{small}
\begin{equation*}
S(x)=\left\{\begin{array}{ll}
x-0,049x^2-0,12x^3&, 0\leq x<\frac{\pi}{2}\\
1+-0,01(x-\frac{\pi}{2})-0,6(x-\frac{\pi}{2})^2+0,13(x-\frac{\pi}{2})^3&, \frac{\pi}{2}\leq x<\pi\\
-0,95(x-\pi)+0,13(x-\pi)^3&, \pi\leq x<\frac{3\pi}{2}\\
-1-0,01(x-\frac{3\pi}{2})+0,6(x-\frac{3\pi}{2})^2-0,12(x-\frac{3\pi}{2})^3&, \frac{3\pi}{2}\leq x\leq2\pi
\end{array}\right.
\end{equation*}  
\end{small}

\ifisscilab
No \verb+Scilab+, podemos resolver este problema fazendo:
\verbatiminput{./cap_interp/codes/splines/ex_spline_fixado.sce}
\fi

\subsection{Resumo sobre splines}

Dado um conjunto de pontos $(x_i,y_i)$, $i=1,2,\ldots,n$, um spline cúbico é a seguinte função interpoladora definida por partes:
\begin{small}
\begin{equation*}
  S(x) \!=\! \left\{\begin{array}{ll}
       \!\!\!a_1 \!+\! b_1(x\!-\!x_1) \!+\! c_1(x\!-\!x_1)^2 \!+\! d_1(x\!-\!x_1)^3 &\!\!\!\!\!, x_1\leq x < x_2\\
      \!\!\!a_2 \!+\! b_2(x\!-\!x_2) \!+\! c_2(x\!-\!x_2)^2 \!+\! d_2(x\!-\!x_2)^3 &\!\!\!\!\!, x_2 \leq x < x_3\\
      \qquad\qquad \vdots & \qquad\vdots \\
      \!\!\!a_{n-1} \!+\! b_{n-1}(x\!-\!x_{n-1}) \!+\! c_{n-1}(x\!-\!x_{n-1})^2 \!+\! d_{n-1}(x\!-\!x_{n-1})^3 &\!\!\!\!\!, x_{n-1} \leq x \leq x_n \end{array}\right.
\end{equation*}
\end{small}

Definindo-se $h_j = x_{j+1} - x_j$, os coeficientes $c_j$, $j=1,2,\dotsc,n$, são solução do sistema linear $Ac = z$, onde:
\begin{small}
  \begin{equation*}
  \begin{array}{|l|l|}\hline
    \text{Spline Natural} & \text{Spline Fixado}\\
    s_1''(x_1) = 0 \text{ e } s_{n-1}''(x_n) = 0 & s_1'(x_1) = f'(x_1) \text{ e } s_{n-1}'(x_n) = f'(x_n)\\ \hline
    a_{i,j} = \left\{
      \begin{array}{ll}
        1 &, j=i=1\\
        h_{i-1} &, j = i-1, i<n\\
        2(h_i + h_{i-1}) &, j=i, 1<i<n\\
        h_i &, j=i+1, i>1\\
        1 &, j=i=n\\
        0 &, \text{caso contrário.}
      \end{array}
\right. &  a_{i,j} = \left\{
      \begin{array}{ll}
        2h_1 &, j=i=1\\
        h_{i-1} &, j = i-1\\
        2(h_i + h_{i-1}) &, j=i, 1<i<n\\
        h_i &, j=i+1\\
        2h_{n-1} &, j=i=n\\
        0 &, \text{caso contrário.}
      \end{array}
\right.\\
&\\
z_i = \left\{
  \begin{array}{ll}
    0 &, i=1\\
    3\frac{y_{i+1}-y_i}{h_i} - 3\frac{y_i-y_{i-1}}{h_{i-1}} &, 1<i<n\\
    0 &, i=n
  \end{array}
\right. & z_i = \left\{
  \begin{array}{ll}
    3\frac{y_2-y_1}{h_1} - 3f'(x_1) &, i=1\\
    3\frac{y_{i+1}-y_i}{h_i} - 3\frac{y_i-y_{i-1}}{h_{i-1}} &, 1<i<n\\
    3f'(x_n) - 3\frac{y_n - y_{n-1}}{h_{n-1}} &, i=n
  \end{array}
\right. \\ \hline
\multicolumn{2}{c}{}
  \end{array}
\end{equation*}
\end{small}
os coeficientes $a_j$, $b_j$ e $d_j$, $j=1,2,\dotsc,n-1$, são calculados conforme segue:
\begin{eqnarray*}
  a_j &=& y_j\\
  b_j &=& \frac{3y_{j+1} - 3y_j - 2c_jh_j^2 - c_{j+1}h_j^2}{3h_j}\\
  d_j &=& \frac{c_{j+1} - c_j}{3h_j}
\end{eqnarray*}

%\end{document} 